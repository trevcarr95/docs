---
title: "Overview"
description: "Suggest Edits"
---

# Overview

The Virtual Accounts API allows partners to retrieve virtual account transaction data through a secure, signed request mechanism. All requests must be authenticated using RSA-SHA256 digital signatures.

# Base URL

```
https://api.moonpay.com/v1/virtual-accounts
```

# Authentication

## RSA-SHA256 Digital Signatures

All API requests must be signed using RSA-SHA256 digital signatures. The signature is generated by signing the complete request payload (including path and query parameters) with your private key.

### Required Headers

| Header         | Description                                                |
| -------------- | ---------------------------------------------------------- |
| `x-signature`  | Base64-encoded RSA-SHA256 signature of the request payload |
| `Content-Type` | `application/json`                                         |

### Signature Generation Process

1. **Create the payload**: Concatenate the request path with query parameters

   ```
   Format: {path}?{queryString}
   Example: /v1/virtual-accounts/transactions/onramp?apiKey=pk_test_xxx&timestamp=1234567890
   ```

2. **Generate signature**: Use RSA-SHA256 to sign the payload with your private key

   <CodeGroup>
     ```javascript javascript const sign = crypto.createSign('SHA256');
     sign.update(payload); const signature = sign.sign(privateKey, 'base64');
     ```
   </CodeGroup>

3. **Include signature**: Add the signature to the `x-signature` header

# Get Virtual Account Details

Retrieves the users virtual account details. If the virtualAccountId and/or externalCustomerId is missing we will return all user virtual accounts.

## Request

### By Virtual Account ID

<CodeGroup>
  ```http http GET /v1/virtual-accounts?apiKey={publishableApiKey}&timestamp=
  {timestamp}&virtualAccountId={virtualAccountId}
  ```
</CodeGroup>

### By External Customer ID:

<CodeGroup>
  ```http http GET /v1/virtual-accounts?apiKey={publishableApiKey}&timestamp=
  {timestamp}&externalCustomerId={externalCustomerId}
  ```
</CodeGroup>

## Query Parameters

| Parameter            | Type   | Required | Description                                                                                |
| -------------------- | ------ | -------- | ------------------------------------------------------------------------------------------ |
| `apiKey`             | string | Yes      | Your publishable API key (starts with `pk_test_` for sandbox or `pk_live_` for production) |
| `timestamp`          | number | Yes      | Unix timestamp in milliseconds for request validation                                      |
| `virtualAccountId`   | string | No       | Optional filter by virtual account id                                                      |
| `externalCustomerId` | string | No       | Optional filter by external customer id                                                    |
| `walletAddress`      | string | No       | Optional filter by wallet address                                                          |

## Headers

| Header         | Type   | Required | Description                                 |
| -------------- | ------ | -------- | ------------------------------------------- |
| `x-signature`  | string | Yes      | RSA-SHA256 signature of the request payload |
| `Content-Type` | string | Yes      | Must be `application/json`                  |

## Example Request

<CodeGroup>
  ```javascript javascript
  async function getVirtualAccountDetails(externalCustomerId = null, virtualAccountId = null) {
    // Generate timestamp
    const timestamp = Date.now();
    
    // Build query string with optional parameters
    let queryParams = [`apiKey=${PUBLISHABLE_API_KEY}`, `timestamp=${timestamp}`];
    if (externalCustomerId) queryParams.push(`externalCustomerId=${externalCustomerId}`);
    if (walletAddress) queryParams.push(`virtualAccountId=${virtualAccountId}`);
    
    // Build payload for signature
    const path = '/v1/virtual-accounts';
    const queryString = queryParams.join('&');
    const payload = `${path}?${queryString}`;
    
    // Create RSA-SHA256 signature
    const sign = crypto.createSign('SHA256');
    sign.update(payload);
    const signature = sign.sign(PRIVATE_KEY, 'base64');
    
    // Make the request
    const url = `${SERVER_URL}${payload}`;
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'x-signature': signature,
        'Content-Type': 'application/json',
      },
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${await response.text()}`);
    }
    
    return await response.json();
  }

// Usage examples:
// Get all virtual accounts
await getVirtualAccountDetails();

// Filter by customer ID only
await getVirtualAccountDetails('customerId123');

// Filter by virtual account ID
await getVirtualAccountDetails(null, 'virtualAccount123');

// Filter by both customer ID and virtual account ID
await getVirtualAccountDetails('customerId123', 'virtualAccount123');

````
</CodeGroup>

### Success Response (200 OK)

<CodeGroup>
```json json
[
  {
    "createdAt": "2025-08-04T11:20:04.819Z",
    "updatedAt": "2025-08-04T11:26:09.493Z",
    "customerId": "ae7fade1-b0c1-48c3-a7cf-ffe2fa18378f",
    "id": "f5aca9b4-11bf-49c3-a51b-b7e5205de123",
    "type": "auto_on_ramp",
    "status": "completed",
    "organizationId": "1de2d6ac-cfac-4148-8919-daeb44e2d89d",
    "destinationCurrency": {
      "notAllowedUSStates": [
        "VI"
      ],
      "notAllowedCountries": [
        "CA"
      ],
      "id": "acb9589d-c7cf-41a8-b220-875f2867bd46",
      "createdAt": "2022-01-04T17:08:50.653Z",
      "updatedAt": "2025-08-18T16:10:00.909Z",
      "type": "crypto",
      "name": "USD Coin (Solana)",
      "code": "usdc_sol",
      "precision": 2,
      "decimals": 6,
      "icon": "https://static.moonpay.com/widget/currencies/usdc.svg",
      "maxAmount": null,
      "minAmount": null,
      "minBuyAmount": 5,
      "maxBuyAmount": 30000,
      "isSellSupported": true,
      "isUtxoCompatible": false,
      "addressRegex": "^[1-9A-HJ-NP-Za-km-z]{32,44}$",
      "testnetAddressRegex": "^[1-9A-HJ-NP-Za-km-z]{32,44}$",
      "supportsAddressTag": false,
      "addressTagRegex": null,
      "supportsTestMode": false,
      "supportsLiveMode": true,
      "isSuspended": false,
      "isStableCoin": true,
      "minSellAmount": 20.27997,
      "maxSellAmount": 10000,
      "isSwapBaseSupported": true,
      "isSwapQuoteSupported": true,
      "isBaseAsset": false,
      "isSupportedInUS": true,
      "metadata": {
        "contractAddress": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
        "coinType": "501",
        "chainId": null,
        "networkCode": "solana"
      }
    },
    "sourceCurrency": {
      "id": "edd81f1f-f735-4692-b410-6def107f17d2",
      "createdAt": "2019-04-29T16:55:28.647Z",
      "updatedAt": "2024-11-26T13:40:31.967Z",
      "type": "fiat",
      "name": "US Dollar",
      "code": "usd",
      "precision": 2,
      "decimals": null,
      "icon": "https://static.moonpay.com/widget/currencies/usd.svg",
      "maxAmount": 12000,
      "minAmount": 30,
      "minBuyAmount": 20,
      "maxBuyAmount": 30000,
      "isSellSupported": true,
      "isUtxoCompatible": false
    },
    "source": {
      "accountAddress": "",
      "accountName": "John Doe",
      "accountNumber": "1234567890",
      "routingNumber": "1234567890",
      "bankAddress": "123 Main St, Anytown, USA",
      "bankName": "Bank of America",
      "type": "ACH"
    },
    "sources": [
      {
        "accountAddress": "",
        "accountName": "John Doe",
        "accountNumber": "1234567890",
        "routingNumber": "1234567890",
        "bankAddress": "123 Main St, Anytown, USA",
        "bankName": "Bank of America",
        "type": "ACH"
      },
      {
        "accountAddress": "",
        "accountName": "John Doe",
        "accountNumber": "1234567890",
        "routingNumber": "1234567890",
        "bankAddress": "123 Main St, Anytown, USA",
        "bankName": "Bank of America",
        "type": "Wire"
      }
    ],
    "destination": {
      "wallet": {
        "walletAddress": "2fxgKXhwRdcBz.....QvZKeUVBgWw1bYysW",
        "walletAddressTag": null
      },
      "network": {
        "code": "solana",
        "createdAt": "2022-03-29T09:26:12.804Z",
        "updatedAt": "2025-08-05T11:58:26.621Z",
        "isAddressCaseSensitive": true,
        "name": "Solana",
        "icon": "https://static.moonpay.com/widget/networks/sol.svg",
        "isEvmCompatible": false,
        "addressRegex": "^[1-9A-HJ-NP-Za-km-z]{32,44}$",
        "supportsAddressTag": false,
        "addressTagRegex": null,
        "outboundConfirmations": 1,
        "inboundConfirmations": 1
      }
    },
    "destinations": [
      {
        "wallet": {
          "walletAddress": "2fxgKXhwRdcFLqXEvJ7QE3nNJBzQvZKeUVBgWw1bYysW",
          "walletAddressTag": null
        },
        "network": {
          "code": "solana",
          "createdAt": "2022-03-29T09:26:12.804Z",
          "updatedAt": "2025-08-05T11:58:26.621Z",
          "isAddressCaseSensitive": true,
          "name": "Solana",
          "icon": "https://static.moonpay.com/widget/networks/sol.svg",
          "isEvmCompatible": false,
          "addressRegex": "^[1-9A-HJ-NP-Za-km-z]{32,44}$",
          "supportsAddressTag": false,
          "addressTagRegex": null,
          "outboundConfirmations": 1,
          "inboundConfirmations": 1
        }
      }
    ],
    "externalCustomerId": 'externalId1'
  }
]
````

</CodeGroup>

### Response Field Descriptions

| Field                 | Type   | Description                                                                                                                                                                                    |
| --------------------- | ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                  | string | Unique virtual account identifier                                                                                                                                                              |
| `externalCustomerId`  | string | External Customer Id                                                                                                                                                                           |
| `type`                | string | Current virtual account type (auto_on_ramp, auto_off_ramp)                                                                                                                                     |
| `state`               | string | Current virtual account state (pending, completed, failed)                                                                                                                                     |
| `sourceCurrency`      | object | Source currency details, including code, name, precision, and limits (Fiat for auto_on_ramp and Crypto for auto_off_ramp)                                                                      |
| `destinationCurrency` | object | Destination currency details (Crypto for auto_on_ramp and Fiat for auto_off_ramp)                                                                                                              |
| `sources`             | array  | Sources account information: Bank account details for auto_on_ramp: name, IBAN, and address. For USD, there will be two accounts: ACH and Wire.`sources.type` could be `ACH`, `Wire` or `SEPA` |
| `destination`         | object | Destination wallet and network information (wallet and network)                                                                                                                                |
| `createdAt`           | string | ISO 8601 timestamp of virtual account creation                                                                                                                                                 |
| `updatedAt`           | string | ISO 8601 timestamp of virtual account last update                                                                                                                                              |

### Virtual Account Types

| Type            | Description                                          |
| --------------- | ---------------------------------------------------- |
| `auto_on_ramp`  | Virtual account is receiving FIAT and sending Crypto |
| `auto_off_ramp` | Virtual account is receiving Crypto and sending FIAT |

### Virtual Account States

| State           | Description                                         |
| --------------- | --------------------------------------------------- |
| `pending`       | Virtual account is being created.                   |
| `manual_review` | Virtual account is in manual review by our team.    |
| `completed`     | Virtual account is ready to use by customer         |
| `failed`        | Virtual account creation failed due to some reason. |

# Get Virtual Account OnRamp Transactions

Retrieves virtual account on-ramp transaction data for the authenticated partner (For VirtualAccount with type = `auto_on_ramp`) You must provide either a `virtualAccountId` or an `externalCustomerId` to identify the account.

## Request

<CodeGroup>
  ```http http GET /v1/virtual-accounts/transactions/onramp?apiKey=
  {publishableApiKey}&timestamp={timestamp}&virtualAccountId={virtualAccountId}
  &cursor={cursor}&pageSize={pageSize}
  ```
</CodeGroup>

## Query Parameters

| Parameter            | Type   | Required    | Description                                                                                                    |
| -------------------- | ------ | ----------- | -------------------------------------------------------------------------------------------------------------- |
| `apiKey`             | string | Yes         | Your publishable API key (starts with `pk_test_` for sandbox or `pk_live_` for production)                     |
| `timestamp`          | number | Yes         | Unix timestamp in milliseconds for request validation                                                          |
| `virtualAccountId`   | string | Conditional | The unique identifier for the customers virtual account. **Required** if `externalCustomerId` is not provided. |
| `externalCustomerId` | string | Conditional | The external identifier for the customer. **Required** if `virtualAccountId` is not provided.                  |
| `pageSize`           | number | Yes         | Number of transactions per page                                                                                |
| `cursor`             | string | No          | Cursor value from the previous page response                                                                   |

## Headers

| Header         | Type   | Required | Description                                 |
| -------------- | ------ | -------- | ------------------------------------------- |
| `x-signature`  | string | Yes      | RSA-SHA256 signature of the request payload |
| `Content-Type` | string | Yes      | Must be `application/json`                  |

## Example Request

<CodeGroup>
  ```javascript javascript
  const crypto = require('crypto');
  const fetch = require('node-fetch');

const SERVER_URL = 'https://api.moonpay.com';
const PUBLISHABLE_API_KEY = '[Your Publishable Api Key]';
const PRIVATE_KEY = `-----BEGIN PRIVATE KEY-----
  [Your Private Key Here]
  -----END PRIVATE KEY-----`;

async function getVirtualAccountTransactions(virtualAccountId) {
// Generate timestamp
const timestamp = Date.now();

    // Build payload for signature
    const path = '/v1/virtual-accounts/transactions/onramp';
    const queryString = `apiKey=${PUBLISHABLE_API_KEY}&timestamp=${timestamp}&virtualAccountId=${virtualAccountId}&pageSize=50`;
    const payload = `${path}?${queryString}`;

    // Create RSA-SHA256 signature
    const sign = crypto.createSign('SHA256');
    sign.update(payload);
    const signature = sign.sign(PRIVATE_KEY, 'base64');

    // Make the request
    const url = `${SERVER_URL}${payload}`;
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'x-signature': signature,
        'Content-Type': 'application/json',
      },
    });

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${await response.text()}`);
    }

    return await response.json();

}

````
</CodeGroup>

### Success Response (200 OK)

<CodeGroup>
```json JSON
{
  "nextCursor": "12345",
  "transactions": [
    {
      "id": "1234567890",
      "status": "Completed",
      "sourceAmount": "100",
      "sourceCurrency": {
        "id": "123",
        "code": "USD",
        "name": "US Dollar",
        "precision": 2,
        "icon": "",
        "maxBuyAmount": 1000000,
        "minBuyAmount": 1,
        "accountBuyMinAmount": 1,
        "isSellSupported": true,
        "maxAmount": 1000000,
        "minAmount": 1,
        "createdAt": "2025-06-10T11:47:27.582Z",
        "updatedAt": "2025-06-10T11:47:27.582Z"
      },
      "destinationAmount": "100",
      "destinationCurrency": {
        "id": "123",
        "code": "usdc_sol",
        "name": "USD Coin (Solana)",
        "precision": 2,
        "icon": "",
        "maxBuyAmount": 1000000,
        "minBuyAmount": 1,
        "accountBuyMinAmount": 1,
        "isSellSupported": true,
        "maxAmount": 1000000,
        "minAmount": 1,
        "createdAt": "2025-06-10T11:47:27.582Z",
        "updatedAt": "2025-06-10T11:47:27.582Z"
      },
      "source": {
        "accountName": "John Doe",
        "iban": "DE89370400440532013000",
        "accountAddress": "123 Main St, Anytown, USA"
      },
      "destination": {
        "wallet": {
          "walletAddress": "0x1234576867890123456789012345678901234567",
          "walletAddressTag": null
        },
        "network": {
          "code": "solana",
          "name": "Solana",
          "icon": "https://static.moonpay.com/widget/currencies/usdc.svg",
          "isAddressCaseSensitive": false,
          "isEvmCompatible": true,
          "addressRegex": "0x[a-fA-F0-9]{40}",
          "supportsAddressTag": true,
          "testnetWalletExplorerLink": "https://solana.com/testnet",
          "mainnetWalletExplorerLink": "https://solana.com/mainnet",
          "testnetTxnExplorerLink": "https://solana.com/testnet",
          "mainnetTxnExplorerLink": "https://solana.com/mainnet",
          "addressTagRegex": "0x[a-fA-F0-9]{40}",
          "createdAt": "2025-06-10T11:47:27.582Z",
          "updatedAt": "2025-06-10T11:47:27.582Z"
        }
      },
      "createdAt": "2025-06-10T11:47:27.582Z"
    }
  ]
}
````

</CodeGroup>

### Response Field Descriptions

| Field          | Type   | Description                      |
| -------------- | ------ | -------------------------------- |
| `nextCursor`   | string | Unique string to fetch next page |
| `transactions` | Array  | Transactions array               |

### Transaction Field Descriptions

| Field                 | Type   | Description                                                                                                                              |
| --------------------- | ------ | ---------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                  | string | Unique transaction identifier                                                                                                            |
| `status`              | string | Current transaction state (Pending, PayoutPending, Payout, PayoutCompleted, Completed, Failed, InAmlReview, AmlRejected, AmountRejected) |
| `sourceAmount`        | string | Amount in source currency                                                                                                                |
| `sourceCurrency`      | object | Source currency details including code, name, precision, and limits                                                                      |
| `destinationAmount`   | string | Amount in destination currency                                                                                                           |
| `destinationCurrency` | object | Destination currency details                                                                                                             |
| `source`              | object | Source account information (name, IBAN, address)                                                                                         |
| `destination`         | object | Destination wallet and network information                                                                                               |
| `createdAt`           | string | ISO 8601 timestamp of transaction creation                                                                                               |

# Errors

## Error responses

### 400 Bad Request

<CodeGroup>
  ```json json
  {
    "success": false,
    "error": {
      "code": "INVALID_REQUEST",
      "message": "Missing required parameter: apiKey"
    }
  }
  ```
</CodeGroup>

### 401 Unauthorized

<CodeGroup>
  ```json json
  {
    "success": false,
    "error": {
      "code": "INVALID_SIGNATURE",
      "message": "Request signature verification failed"
    }
  }
  ```
</CodeGroup>

### 403 Forbidden

<CodeGroup>
  ```json json
  {
    "success": false,
    "error": {
      "code": "INVALID_API_KEY",
      "message": "The provided API key is invalid or inactive"
    }
  }
  ```
</CodeGroup>

### 429 Too Many Requests

<CodeGroup>
  ```json json
  {
    "success": false,
    "error": {
      "code": "RATE_LIMIT_EXCEEDED",
      "message": "Rate limit exceeded. Please try again later."
    }
  }
  ```
</CodeGroup>

### 500 Internal Server Error

<CodeGroup>
  ```json json
  {
    "success": false,
    "error": {
      "code": "INTERNAL_ERROR",
      "message": "An internal server error occurred"
    }
  }
  ```
</CodeGroup>

## Error Handling Best Practices

1. **Always check response status codes** before processing response data
2. **Implement retry logic** for transient errors (5xx status codes)
3. **Log signature generation details** for debugging authentication issues
4. **Handle rate limiting** by implementing exponential backoff

# Security Considerations

## Private Key Management

- **Never expose your private key** in client-side code or public repositories
- Store private keys securely using environment variables or secure key management systems
- Rotate private keys regularly for enhanced security

## Request Validation

- Timestamps are validated to prevent replay attacks
- Signatures are verified against your registered public key
- All requests must be made over HTTPS in production

## Rate Limiting

- API requests are rate-limited per API key
- Current limit: 100 requests per minute per API key
- Exceeding rate limits will result in HTTP 429 responses

# Testing

## Sandbox Environment

Use the following for testing:

- API Key: Test keys start with `pk_test_`

## Sample Test Data

The sandbox environment includes sample virtual account transactions for testing integration.

---

- [Table of Contents](#)

- - [Overview](#overview)

  - [Base URL](#base-url)

  - [Authentication](#authentication)

    - [RSA-SHA256 Digital Signatures](#rsa-sha256-digital-signatures)

  - [Get Virtual Account Details](#get-virtual-account-details)

    - [Request](#request)
    - [Query Parameters](#query-parameters)
    - [Headers](#headers)
    - [Example Request](#example-request)

  - [Get Virtual Account OnRamp Transactions](#get-virtual-account-onramp-transactions)

    - [Request](#request-1)
    - [Query Parameters](#query-parameters-1)
    - [Headers](#headers-1)
    - [Example Request](#example-request-1)

  - [Errors](#errors)

    - [Error responses](#error-responses)
    - [Error Handling Best Practices](#error-handling-best-practices)

  - [Security Considerations](#security-considerations)

    - [Private Key Management](#private-key-management)
    - [Request Validation](#request-validation)
    - [Rate Limiting](#rate-limiting)

  - [Testing](#testing)

    - [Sandbox Environment](#sandbox-environment)
    - [Sample Test Data](#sample-test-data)
